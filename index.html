<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生成配置文件</title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" type="text/javascript"></script>
    <script src="./data.js"></script>
    <script>
        let likeNum = "Math.ceil(1000000*Math.random)+1";
        let staySec = "1e2";
        let loadData = function() {
            window.decodeJsonData = function(d) {
                document.getElementById("loading").innerHTML = "";
                let dd = d.data.replace(/&quot;/g, '"').replace(/&apos;/g, "'").replace(/&fyh;/g, "`").replace(/&qquot;/g, "&quot;");
                dd.replace(/dingtalk\.grouplive\.uploadLikesClick\(B,t\.favorCountCache\),t\.favorCountCache=0\)\},1e4/, "dingtalk.grouplike.uploadLikesClick(B,"+likeNum+"),t.favorCountCache=0)},"+staySec)
                window.finalData = dd;
                document.getElementById("loading").style.display = "block";
            }
            // $.ajax({
            //     type: "POST",
            //     dataType: "json",
            //     url: "data.json?t="+Math.random(),
            //     success: window.decodeJsonData, 
            //     error: function(){console.log("请求失败")}
            // });
            window.decodeJsonData(mainmainmain);
        }
        let downloadData = function() {
            let tag = document.createElement("a");
            let blob = new Blob([window.finalData]);
            tag.style = "display:none";
            tag.download = "data.html";
            tag.href = URL.createObjectURL(blob);
            document.getElementsByTagName("body")[0].appendChild(tag);
            tag.click();
            setTimeout(function() {
                document.getElementsByTagName("body")[0].removeChild(tag);
                window.URL.revokeObjectURL(blob);
            }, 100);
        }
    </script>
    <script>window.onload = loadData;</script>
</head>
<body>
    <div id="loading">加载组件中......</div>
    <button onclick="downloadData()" style="display:none">Download</button>
</body>
</html>
